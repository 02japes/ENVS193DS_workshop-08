---
title: "Simple linear model example"
---

**Relevant definitions:**  

specific leaf area (SLA, units: mm^2^/g): surface area of a leaf divided by its dry mass, represents life strategy (high SLA = large surface area and low mass = "fast" species)  

root mass (units: g): mass of root tissue  

shoot mass (units: g): mass of aboveground tissue  

```{r}
library(tidyverse)
library(here)
library(readxl)
library(janitor)
library(MuMIn)
library(ggeffects)
library(flextable)

drought_exp <- read_xlsx(path = here("data", "Valliere_etal_EcoApps_Data.xlsx"),
                    sheet = "First Harvest")
```

## cleaning

```{r}
drought_exp_clean <- drought_exp %>% 
  clean_names() %>% 
  mutate(species = case_when(
    species == "ACMGLA" ~ "Acmispon glaber",
    species == "ENCCAL" ~ "Encelia californica",
    species == "ESCCAL" ~ "Escholzia californica",
    species == "PENCEN" ~ "Penstemon centranthifolius",
    species == "GRICAM" ~ "Grindelia camporum",
    species == "SALLEU" ~ "Salvia leucophylla",
    species == "STIPUL" ~ "Stipa pulchra",
    species == "LOTSCO" ~ "Lotus scoparius"
  )) %>% 
  mutate(water = case_when(
    water == "DS" ~ "Drought stressed",
    water == "WW" ~ "Watered well"
  ))
```

What is the influence of specific leaf area (SLA) on total mass?

```{r}
ggplot(data = drought_exp_clean,
       aes(x = sla,
           y = total_g,
           color = water)) +
  geom_point()
```

```{r}
model <- lm(total_g ~ sla,
            data = drought_exp_clean)

plot(model)
```

```{r}
summary(model)
```

Equation

$$
y = 0.045 + 0.002x
$$

Interpretation of slope in words:

For each 1 unit increase in specific leaf area (mm^2^/g), we expect a 0.002 ± 0.0004 g increase in total mass. 

Calculating a correlation coefficient:

```{r}
cor.test(drought_exp_clean$sla, drought_exp_clean$total_g)
```

Pearson's r = 0.45 95% CI 0.24, 0.62

All together in text:
We found a strongly positive (Pearson's r = 0.45) relationship between specific leaf area and total mass (R^2^ = 0.21, F(1, 68) = 17.53, p < 0.001, ⍺ = 0.05). For each 1 unit increase in specific leaf area (mm^2^/g), we expect a 0.002 ± 0.0004 g increase in total mass. 

Bonus table:

```{r}
as_flextable(model)
```

```{r}
model_preds <- ggpredict(model, 
                         terms = "sla")
# x column = sla
# predicted column = total mass
# std.error = standard error
# conf.low = lower bound of 95% CI
# conf.high = upper bound of 95% CI

ggplot(data = drought_exp_clean,
       aes(x = sla,
           y = total_g)) +
  geom_point(shape = 21) +
  geom_ribbon(data = model_preds,
              aes(x = x,
                  y = predicted,
                  ymin = conf.low,
                  ymax = conf.high),
              alpha = 0.2) +
  geom_line(data = model_preds,
            aes(x = x,
                y = predicted),
            color = "darkgreen", 
            linewidth = 2) +
  theme_classic() +
  labs(x = "Specific leaf area",
       y = "Total mass")
```


